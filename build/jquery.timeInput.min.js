(function(f){var n={step:900,min:"0:00",max:"23:45",onlyForBrowsersWithoutSupport:false},h,l,i=false,j=false,k=false;f.fn.timeInput=function(a){return this.each(function(){f(this).attr("autocomplete","OFF").bind("focus click",function(){d.listIsVisible()||d.showTimePicker(this,a)}).bind("blur",function(){d.listIsVisible()&&!j&&d.hideTimePicker()}).bind("change",function(){var b=f(this),c=b.val(),e=c;if(e.indexOf(":")<0)e=d.insertTimeSeparator(e);if(d.isValidTimeString(e)){if(e)e=d.correctTimeAccordingToSettings(e,
b.data("timeInputSettings"))}else e="";e!=c&&b.val(e)}).bind("keydown",function b(c,e){if(!f.browser.opera)if(!(c.keyCode!=38&&c.keyCode!=40)){if(!d.listIsVisible())return d.showTimePicker(this,a);e||(e=0);if(!(k&&e===0)){k=true;c.keyCode==38?d.prevOption():d.nextOption();l=setTimeout(function(){b(c,++e)},e>=2?100:200)}}}).bind("keyup",function(b){k=false;clearInterval(l);if(f.browser.opera&&(b.keyCode==38||b.keyCode==40))f(this).trigger("input")}).bind("keypress",function(b){switch(b.keyCode){case 13:d.chooseSelectedOption();
b.preventDefault();break;case 27:d.hideTimePicker();f(this).blur();break;case 9:b=f(this).val();d.isValidTimeString(b)&&b.length<5&&f(this).val(d.dateToTime(d.timeToDate(b)));d.hideTimePicker();break}}).bind("input",function(){var b=f(this).val();if(b){d.listIsVisible()||d.showTimePicker(this,a);b=d.insertTimeSeparator(b);d.selectOption("ul.time-input-list:visible li:contains('"+b+"'):first")}})})};var d={showTimePicker:function(a,b){h=f(a);var c=f.extend({},n,d.getSettings(h),b);c.step=parseInt(c.step,
10);d.validateSettings(c);h.data("timeInputSettings",c);c=d.getDataList(c);d.positionList(c,h);c.show();if(h.val()){c=h.val();d.selectOption("ul.time-input-list:visible li:contains('"+c+"')")}else d.selectOption("ul.time-input-list:visible li:first")},hideTimePicker:function(){f("ul.time-input-list li.selected").removeClass("selected");f("ul.time-input-list").hide()},prevOption:function(){var a=f("ul.time-input-list:visible li.selected");a.is(":first-child")||d.selectOption(a.prev())},nextOption:function(){var a=
f("ul.time-input-list:visible li.selected");if(a.size()==0)d.selectOption("ul.time-input-list:visible li:first-child");else a.is(":last-child")||d.selectOption(a.next())},selectOption:function(a){var b=f(a).addClass("selected");if(b.size()!=0){b.siblings().removeClass("selected");a=b.parent();var c=b.get(0).offsetTop,e=a.scrollTop();b=a.height()-b.height();if(c<e)a.scrollTop(c);else c>e+b&&a.scrollTop(c-b);i=true;setTimeout(function(){i=false},0)}},chooseSelectedOption:function(){var a=f("ul.time-input-list:visible li.selected");
a.size()==1&&h.val(a.text());d.hideTimePicker()},getSettings:function(a){a=f(a);for(var b={},c=0,e=["step","min","max"],g;g=e[c];c++){var m=a.attr(g);if(m)b[g]=m}return b},validateSettings:function(a){if(typeof a.min!="string"||!d.isValidTimeString(a.min))throw Error("min has to be a valid time string (13:45)");else if(typeof a.max!="string"||!d.isValidTimeString(a.max))throw Error("max has to be a valid time string (13:45)");else if(a.step<0||a.step>43200)throw Error("step has to be a number between 0 and 60 * 60 * 12");
},listIsVisible:function(){return f("ul.time-input-list").is(":visible")},getDataList:function(a){var b=d.getUniqueKeyFor(a),c=f("#"+b);if(c.size()!=1){c=f("<ul/>",{id:b}).addClass("time-input-list");a=d.generateTimeList(a);b=0;for(var e=a.length;b<e;b++){var g=a[b];c.append(f("<li/>").text(g))}c.delegate("li","click",d.chooseSelectedOption).delegate("li","mouseover",function(){if(i)return false;f(this).siblings().removeClass("selected");f(this).addClass("selected")});c.bind("mouseenter",function(){j=
true}).bind("mouseleave",function(){j=false}).appendTo("body");d.adjustHeight(c)}return c},adjustHeight:function(a){var b=a.height();a.css("height","auto");b<a.height()&&a.css("height",null)},getUniqueKeyFor:function(a){var b="",c=[];for(var e in a)c.push(e);c.sort();e=0;for(var g=c.length;e<g;e++)b+=a[c[e]];return b.replace(/[\W]/g,"")},generateTimeList:function(a){for(var b=[],c=d.dateToTime(d.timeToDate(a.min)),e=d.timeToDate(a.max);d.timeToDate(c)<=e;){b.push(c);try{c=d.addSecondsToTime(c,a.step)}catch(g){break}}return b},
positionList:function(a,b){var c=f.extend({},b.offset(),{position:"absolute"});c.top+=b.height();c.top+=parseInt(b.css("border-top-width"))||0;c.top+=parseInt(b.css("padding-top"))||0;c.top+=parseInt(b.css("padding-bottom"))||0;a.css(c)},correctTimeAccordingToSettings:function(a,b){var c=d.timeToDate(a),e=d.timeToDate(b.min),g=d.timeToDate(b.max);if(c<e)return d.dateToTime(e);if(c>g)return d.dateToTime(g);g=b.step/60;e=(c.getTime()-e.getTime())/1E3/60%g;if(e>=g/2)c=d.addSecondsToDate(c,(g-e)*60);
else if(e>0)c=d.addSecondsToDate(c,e*-60);return d.dateToTime(c)},isValidTimeString:function(a){if(a===null||a=="")return true;return/^([0,1]?\d|2[0-3]):[0-5]\d:?\d{0,2}$/.test(a)},insertTimeSeparator:function(a){return a.replace(/^([0-1]?\d|2[0-3]):?(\d{0,2}):?\d{0,2}$/,"$1:$2")},dateToTime:function(a){if(a.getDate()!==1)throw Error("Date has to be Jan 1st 1970 when converting to time");return a.toTimeString().substring(0,5)},timeToDate:function(a){return new Date("Jan 1 1970 "+a)},addSecondsToTime:function(a,
b){var c=d.addSecondsToDate(d.timeToDate(a),b);return d.dateToTime(c)},addSecondsToDate:function(a,b){var c=a.getTime();return new Date(c+b*1E3)}};f.timeInput=d})(jQuery);
